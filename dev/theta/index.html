<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Theta · Durbyn.jl</title><meta name="title" content="Theta · Durbyn.jl"/><meta property="og:title" content="Theta · Durbyn.jl"/><meta property="twitter:title" content="Theta · Durbyn.jl"/><meta name="description" content="Documentation for Durbyn.jl."/><meta property="og:description" content="Documentation for Durbyn.jl."/><meta property="twitter:description" content="Documentation for Durbyn.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/theme.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Durbyn.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Durbyn.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../quickstart/">Quick Start</a></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../grammar/">Grammar</a></li><li><a class="tocitem" href="../naive/">Naive Methods</a></li><li><a class="tocitem" href="../expsmoothing/">Exponential Smoothing</a></li><li class="is-active"><a class="tocitem" href>Theta</a><ul class="internal"><li><a class="tocitem" href="#Formula-Interface-(primary-usage)"><span>Formula Interface (primary usage)</span></a></li><li><a class="tocitem" href="#Base-API-(array-interface)"><span>Base API (array interface)</span></a></li><li><a class="tocitem" href="#Methodology-(Fiorucci-et-al.,-2016)"><span>Methodology (Fiorucci et al., 2016)</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../bats/">BATS</a></li><li><a class="tocitem" href="../tbats/">TBATS</a></li><li><a class="tocitem" href="../intermittent/">Intermittent Demand</a></li><li><a class="tocitem" href="../arima/">ARIMA</a></li><li><a class="tocitem" href="../diffusion/">Diffusion</a></li><li><a class="tocitem" href="../arar/">ARAR</a></li><li><a class="tocitem" href="../ararma/">ARARMA</a></li><li><a class="tocitem" href="../stats/">Statistics</a></li><li><a class="tocitem" href="../optimize/">Optimization</a></li><li><a class="tocitem" href="../utils/">Utilities</a></li><li><a class="tocitem" href="../tableops/">Table Operations</a></li></ul></li><li><a class="tocitem" href="../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User Guide</a></li><li class="is-active"><a href>Theta</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Theta</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/taf-society/Durbyn.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/taf-society/Durbyn.jl/blob/main/docs/src/theta.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Theta-Method-(STM,-OTM,-DSTM,-DOTM)"><a class="docs-heading-anchor" href="#Theta-Method-(STM,-OTM,-DSTM,-DOTM)">Theta Method (STM, OTM, DSTM, DOTM)</a><a id="Theta-Method-(STM,-OTM,-DSTM,-DOTM)-1"></a><a class="docs-heading-anchor-permalink" href="#Theta-Method-(STM,-OTM,-DSTM,-DOTM)" title="Permalink"></a></h1><div class="admonition is-success" id="Formula-Interface-is-the-Recommended-Approach-db5a5249f7367d96"><header class="admonition-header">Formula Interface is the Recommended Approach<a class="admonition-anchor" href="#Formula-Interface-is-the-Recommended-Approach-db5a5249f7367d96" title="Permalink"></a></header><div class="admonition-body"><p>Use <code>ThetaSpec</code> with <code>@formula</code> for a declarative interface that works with panel data, grouped fitting, and model comparison. The base (array) API is shown near the end.</p></div></div><p>The Theta method decomposes a series into <strong>theta lines</strong> (one capturing long-run trend, one capturing short-run curvature) and recombines their forecasts. Durbyn implements the four variants discussed by Fiorucci et al. (2016):</p><ul><li><code>:STM</code> - Simple Theta (theta = 2 fixed, alpha optimized)</li><li><code>:OTM</code> - Optimized Theta (theta and alpha optimized)</li><li><code>:DSTM</code> - Dynamic Simple Theta (theta = 2, regression coefficients updated each step)</li><li><code>:DOTM</code> - Dynamic Optimized Theta (dynamic regression + optimized theta, alpha)</li></ul><p>Seasonality is handled with additive or multiplicative decomposition prior to fitting (auto-detected unless specified).</p><h3 id="Variant-Selection-Guide"><a class="docs-heading-anchor" href="#Variant-Selection-Guide">Variant Selection Guide</a><a id="Variant-Selection-Guide-1"></a><a class="docs-heading-anchor-permalink" href="#Variant-Selection-Guide" title="Permalink"></a></h3><table><tr><th style="text-align: right">Variant</th><th style="text-align: right">Best for</th><th style="text-align: right">Trade-off</th></tr><tr><td style="text-align: right"><strong>STM</strong></td><td style="text-align: right">Quick baseline forecasts</td><td style="text-align: right">Fast but less flexible (fixed θ=2)</td></tr><tr><td style="text-align: right"><strong>OTM</strong></td><td style="text-align: right">Series where θ≠2 improves fit</td><td style="text-align: right">Better accuracy, slightly slower</td></tr><tr><td style="text-align: right"><strong>DSTM</strong></td><td style="text-align: right">Non-stationary trend patterns</td><td style="text-align: right">Adapts to changing trends</td></tr><tr><td style="text-align: right"><strong>DOTM</strong></td><td style="text-align: right">Complex series with evolving dynamics</td><td style="text-align: right">Most flexible, best for longer series</td></tr></table><p>Use <code>theta()</code> with no model argument to let Durbyn auto-select the best variant via in-sample MSE.</p><hr/><h2 id="Formula-Interface-(primary-usage)"><a class="docs-heading-anchor" href="#Formula-Interface-(primary-usage)">Formula Interface (primary usage)</a><a id="Formula-Interface-(primary-usage)-1"></a><a class="docs-heading-anchor-permalink" href="#Formula-Interface-(primary-usage)" title="Permalink"></a></h2><pre><code class="language-julia hljs">using Durbyn, Durbyn.Grammar

data = (sales = [120, 135, 148, 152, 141, 158, 170, 165, 180, 195],)

# Auto-select among STM/OTM/DSTM/DOTM via in-sample MSE
spec = ThetaSpec(@formula(sales = theta()))
fitted = fit(spec, data, m = 12)
fc = forecast(fitted, h = 12)</code></pre><h3 id="Dynamic-Optimised-Theta-with-explicit-options"><a class="docs-heading-anchor" href="#Dynamic-Optimised-Theta-with-explicit-options">Dynamic Optimised Theta with explicit options</a><a id="Dynamic-Optimised-Theta-with-explicit-options-1"></a><a class="docs-heading-anchor-permalink" href="#Dynamic-Optimised-Theta-with-explicit-options" title="Permalink"></a></h3><pre><code class="language-julia hljs">using Durbyn, Durbyn.Grammar

data = (demand = collect(1.0:100.0),)

spec = ThetaSpec(@formula(demand = theta(
    model = :DOTM,
    decomposition = &quot;multiplicative&quot;,
    nmse = 5,              # optimise on 1-5 step SSE
    theta_param = nothing, # optimise theta
    alpha = nothing        # optimise alpha
)))

fitted = fit(spec, data, m = 12)
fc = forecast(fitted, h = 12)</code></pre><h3 id="Panel-data-/-grouped-fitting"><a class="docs-heading-anchor" href="#Panel-data-/-grouped-fitting">Panel data / grouped fitting</a><a id="Panel-data-/-grouped-fitting-1"></a><a class="docs-heading-anchor-permalink" href="#Panel-data-/-grouped-fitting" title="Permalink"></a></h3><pre><code class="language-julia hljs">using Durbyn, Durbyn.TableOps, Durbyn.ModelSpecs, Durbyn.Grammar

# stacked table with :series column
panel = PanelData(tbl; groupby = :series, date = :date, m = 12)
spec = ThetaSpec(@formula(value = theta(model = :OTM, decomposition = &quot;additive&quot;)))
fitted = fit(spec, panel)
fc = forecast(fitted, h = 12)</code></pre><p>Key options (all optional): <code>model</code>, <code>alpha</code>, <code>theta_param</code>, <code>decomposition</code> (&quot;multiplicative&quot; or &quot;additive&quot;), <code>nmse</code> (1–30 step MSE objective).</p><hr/><h2 id="Base-API-(array-interface)"><a class="docs-heading-anchor" href="#Base-API-(array-interface)">Base API (array interface)</a><a id="Base-API-(array-interface)-1"></a><a class="docs-heading-anchor-permalink" href="#Base-API-(array-interface)" title="Permalink"></a></h2><pre><code class="language-julia hljs">using Durbyn

y = collect(1.0:50.0) .+ randn(50)

# Fit a specific variant
fit_otm = theta(y, 12; model_type = OTM, nmse = 3)   # Optimised Theta

# Let Durbyn choose the best variant by MSE
fit_auto = auto_theta(y, 12)

fc = forecast(fit_auto; h = 8)  # returns Forecast with mean &amp; intervals</code></pre><p><code>ThetaFit</code> exposes <code>model_type</code>, <code>alpha</code>, <code>theta</code>, <code>initial_level</code>, <code>mse</code>, fitted values, residuals, and decomposition metadata.</p><hr/><h2 id="Methodology-(Fiorucci-et-al.,-2016)"><a class="docs-heading-anchor" href="#Methodology-(Fiorucci-et-al.,-2016)">Methodology (Fiorucci et al., 2016)</a><a id="Methodology-(Fiorucci-et-al.,-2016)-1"></a><a class="docs-heading-anchor-permalink" href="#Methodology-(Fiorucci-et-al.,-2016)" title="Permalink"></a></h2><p>The classic Theta line with second-difference scaling <span>$\theta$</span>:</p><p class="math-container">\[Z_t(\theta) = \theta Y_t + (1-\theta)(A_n + B_n t), \qquad
A_n = \overline{Y} - \tfrac{n+1}{2}B_n,\quad
B_n = \frac{6}{n^2-1}\!\left(\frac{2}{n}\sum_{t=1}^{n} tY_t - \frac{1+n}{n}\sum_{t=1}^{n} Y_t\right).\]</p><p>Recomposition for <span>$\theta_1 = 0, \theta_2 = \theta$</span> gives</p><p class="math-container">\[Y_t = \left(1-\tfrac{1}{\theta}\right)(A_n + B_n t) + \tfrac{1}{\theta} Z_t(\theta).\]</p><p>Forecasts combine regression and the SES extrapolation of the theta line:</p><p class="math-container">\[\widehat{Y}_{n+h\mid n} =
\left(1-\tfrac{1}{\theta}\right)\!\bigl[A_n + B_n(n+h)\bigr]
 + \tfrac{1}{\theta}\,\widetilde{Z}_{n+h\mid n}(\theta),\]</p><p>with SES recursion and closed form for <span>$h=1$</span>:</p><p class="math-container">\[\ell_t = \alpha Y_t + (1-\alpha)\ell_{t-1}, \qquad \ell_0 = \ell_0^*/\theta\]</p><p class="math-container">\[\widetilde{Z}_{n+1\mid n}(\theta) =
\theta \ell_n + (1-\theta)\!\left[
  A_n\bigl(1-(1-\alpha)^n\bigr) +
  B_n\Bigl(n+\bigl(1-\tfrac{1}{\alpha}\bigr)\bigl(1-(1-\alpha)^n\bigr)\Bigr)
\right].\]</p><p>Optimised Theta (state-space form):</p><p class="math-container">\[Y_t = \mu_t + \varepsilon_t, \qquad
\mu_t = \ell_{t-1} + \left(1-\tfrac{1}{\theta}\right)\!\left[(1-\alpha)^{t-1}A_n + \tfrac{1-(1-\alpha)^t}{\alpha}B_n\right], \qquad
\ell_t = \alpha Y_t + (1-\alpha)\ell_{t-1}.\]</p><p>The <span>$h$</span>-step-ahead forecast from origin <span>$n$</span>:</p><p class="math-container">\[\widehat{Y}_{n+h\mid n} = \ell_n + \left(1-\tfrac{1}{\theta}\right)\!\left[(1-\alpha)^n A_n + \left[(h-1) + \tfrac{1-(1-\alpha)^{n+1}}{\alpha}\right]B_n\right].\]</p><p>Dynamic variants update regression coefficients each period:</p><p class="math-container">\[\widehat{Y}_{t+1\mid t} = \ell_t + \left(1-\tfrac{1}{\theta}\right)\!\left[(1-\alpha)^t A_t + \tfrac{1-(1-\alpha)^{t+1}}{\alpha}B_t\right],\]</p><p class="math-container">\[A_t = \overline{Y}_t - \tfrac{t+1}{2} B_t, \qquad
B_t = \tfrac{1}{t+1}\!\left[(t-2)B_{t-1} + \tfrac{6}{t}(Y_t - \overline{Y}_{t-1})\right], \qquad
\overline{Y}_t = \tfrac{1}{t}\!\left[(t-1)\overline{Y}_{t-1} + Y_t\right].\]</p><p>Parameters are estimated by SSE / Gaussian likelihood:</p><p class="math-container">\[(\widehat{\ell}_0, \widehat{\alpha}, \widehat{\theta}) = \arg\min_{\ell_0,\alpha,\theta} \sum_{t=1}^{n} (Y_t - \mu_t)^2,
\qquad
l = -\tfrac{n}{2}\log(\mathrm{SSE}/n) - \tfrac{n}{2}(1+\log 2\pi).\]</p><h3 id="Prediction-intervals"><a class="docs-heading-anchor" href="#Prediction-intervals">Prediction intervals</a><a id="Prediction-intervals-1"></a><a class="docs-heading-anchor-permalink" href="#Prediction-intervals" title="Permalink"></a></h3><p>The conditional variance for <span>$h$</span>-step-ahead forecasts:</p><p class="math-container">\[\mathrm{Var}\!\left[Y_{n+h} \mid Y_1,\ldots,Y_n\right] = \left[1 + (h-1)\alpha^2\right]\sigma^2,\]</p><p>yielding prediction intervals:</p><p class="math-container">\[\widehat{Y}_{n+h\mid n} \pm z_{1-a/2}\sqrt{\left[1 + (h-1)\alpha^2\right]\sigma^2}.\]</p><h3 id="Connection-to-SES-with-drift"><a class="docs-heading-anchor" href="#Connection-to-SES-with-drift">Connection to SES with drift</a><a id="Connection-to-SES-with-drift-1"></a><a class="docs-heading-anchor-permalink" href="#Connection-to-SES-with-drift" title="Permalink"></a></h3><p>The mapping to SES with drift (Theorem 2 in Fiorucci et al.) is <span>$b = (1-\tfrac{1}{\theta})B_n$</span> and <span>$\ell^{**}_0 = \ell_0 + (1-\tfrac{1}{\theta})A_n$</span>.</p><hr/><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ul><li>Fiorucci, J. A., Pellegrini, T. R., Louzada, F., Petropoulos, F., &amp; Koehler, A. B. (2016). <em>Models for optimising the theta method and their relationship to state space models.</em> International Journal of Forecasting, 32(4), 1151–1161.</li><li>Assimakopoulos, V., &amp; Nikolopoulos, K. (2000). The theta model: a decomposition  approach to forecasting. International Journal of Forecasting, 16(4), 521-530.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../expsmoothing/">« Exponential Smoothing</a><a class="docs-footer-nextpage" href="../bats/">BATS »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Friday 20 February 2026 16:20">Friday 20 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
